<!-- @format -->

# 機能仕様書: AI 駆動手首・母指可動域リハビリテーションアプリ

**機能ブランチ**: `001-ai-mediapipe-google`
**作成日**: 2025 年 9 月 14 日
**ステータス**: ドラフト
**入力**: ユーザー説明: "手首と母指の可動域を自動で測定・記録するリハビリアプリ。カメラを使った骨格推定 AI（MediaPipe など）で手首（橈骨手根関節）の掌屈・背屈・尺屈・橈屈と、母指（母指手根中手関節）の屈曲・伸展・内転・外転の可動域を測定。毎日の可動域自動記録、Google カレンダー連携でリハビリ・診察予定管理、進捗グラフ表示、AI 励まし機能を含む。"

## 実行フロー (main)

```
1. 入力からユーザー説明を解析 ✓
   → 機能が明確に定義されている: 手首・母指の動作追跡AI駆動リハビリアプリ
2. 説明から主要概念を抽出 ✓
   → アクター: 患者
   → アクション: 動作測定、データ記録、進捗追跡、カレンダー記録
   → データ: 可動域測定値、進捗データ、カレンダー記録
   → 制約: 精度要件、日常使用、医療準拠
3. 不明確な点について:
   → 該当箇所に[要確認]でマーク
4. ユーザーシナリオ・テスト項目の記載 ✓
   → リハビリ追跡の明確なユーザーフロー
5. 機能要件の生成 ✓
   → すべての要件がテスト可能で測定可能
6. 主要エンティティの特定 ✓
   → 動作データ、ユーザー、進捗データ、カレンダー記録
7. レビューチェックリストの実行
   → 一部確認が必要だが、コア機能は明確
8. 戻り値: 成功（仕様書は計画段階の準備完了）
```

---

## ⚡ クイックガイドライン

- ✅ ユーザーが何を必要とし、なぜ必要なのかに焦点を当てる
- ❌ 実装方法は避ける（技術スタック、API、コード構造なし）
- 👥 開発者ではなく、ビジネス関係者向けに記述

---

## ユーザーシナリオ・テスト _(必須)_

### 主要ユーザーストーリー

患者は手首や母指のリハビリテーション中に、毎日のトレーニング後にカメラの前で指定された動作を行うことで、自動的に可動域を測定し記録できる。測定データは自動的に保存され、進捗をグラフで確認することができる。また、カレンダー形式で毎日の測定記録や体調メモを日記のように振り返ることができ、リハビリの継続をサポートする。

### 受け入れシナリオ

1. **前提条件** ユーザーがアプリを開いている状態で、**操作** カメラ測定を開始し手首の掌屈・背屈動作を行う、**期待結果** 可動域の角度が自動測定され記録される
2. **前提条件** 測定データが蓄積されている状態で、**操作** 進捗画面を開く、**期待結果** 時系列テーブルで回復の推移が表示される
3. **前提条件** 測定が完了した状態で、**操作** データを確認する、**期待結果** 手首（掌屈 0-90°・背屈 0-70°・尺屈 0-55°・橈屈 0-25°）と母指（屈曲 0-90°・伸展 0°・内転 0°・外転 0-60°）の各可動域が正常範囲と共に記録されている
4. **前提条件** 可動域に制限がある状態で、**操作** 測定を実行する、**期待結果** 正常範囲を下回る場合は注意喚起と改善アドバイスが表示される
5. **前提条件** ユーザーがカレンダー画面を開いている状態で、**操作** 過去の日付をタップする、**期待結果** その日の測定データと体調メモが表示される
6. **前提条件** 測定完了後の状態で、**操作** 体調や気分のメモを入力する、**期待結果** その日のカレンダーにメモが保存され、後で確認できる
7. **前提条件** カレンダー表示の状態で、**操作** 月表示で過去の記録を確認する、**期待結果** 測定実施日がマークされ、一目でリハビリ継続状況が分かる

### エッジケース

- カメラの映像が不鮮明な場合、測定精度が低下した際の警告表示
- ネットワーク接続が不安定な場合のデータ同期処理
- 測定姿勢が不適切な場合のガイダンス表示
- 可動域に異常な数値が検出された場合のアラート
- 正常範囲を大幅に超える可動域が測定された場合の再測定要求
- 連続して正常範囲を下回る測定値が記録された場合の注意表示
- カレンダーで複数日測定が未実施の場合の継続促進メッセージ表示
- メモの文字数制限を超えた場合の警告表示

## 要件 _(必須)_

### 機能要件

- **FR-001**: システムはカメラを使用して手首の掌屈・背屈・尺屈・橈屈の可動域を自動測定できなければならない
- **FR-002**: システムは母指の屈曲・伸展・内転・外転の可動域を自動測定できなければならない
- **FR-003**: システムは測定された可動域データを日付と共に自動記録できなければならない
- **FR-004**: システムは AI による励ましメッセージやアドバイスを提供できなければならない
- **FR-005**: システムは測定精度を保つための姿勢ガイダンスを表示できなければならない
- **FR-006**: システムは測定データをローカルで安全に保存できなければならない
- **FR-007**: システムは前日の測定データと現在の測定値を比較表示できなければならない
- **FR-008**: システムは 1 日 1 回の測定頻度に基づいて測定リマインダーを送信できなければならない
- **FR-009**: システムは可動域の正常範囲基準値（手首：掌屈 90°・背屈 70°・尺屈 55°・橈屈 25°、母指：屈曲 90°・伸展 0°・内転 0°・外転 60°）に基づいて正常な値が出ているかを検出できなければならない
- **FR-010**: システムは各関節の可動域測定において ±5° 以内の精度を保証できなければならない
- **FR-011**: システムは測定時に正常範囲と現在値の比較を数値として日にちで表示できなければならない
- **FR-012**: システムはカレンダー形式で毎日の測定記録を表示できなければならない
- **FR-013**: システムは各日付に体調や気分のメモを記録・保存できなければならない
- **FR-014**: システムはカレンダー上で測定実施日を視覚的にマークして表示できなければならない
- **FR-015**: システムは過去の日付をタップして、その日の詳細な測定データとメモを表示できなければならない
- **FR-016**: システムは月単位でリハビリ継続状況を一覧表示できなければならない

### 主要エンティティ _(機能にデータが関わる場合に含める)_

- **ユーザー**: 患者の基本情報、リハビリ開始日、現在の症状レベル
- **動作測定**: 測定日時、手首の各方向可動域（掌屈 0-90°・背屈 0-70°・尺屈 0-55°・橈屈 0-25°）、母指の各方向可動域（屈曲 0-90°・伸展 0°・内転 0°・外転 0-60°）、測定精度スコア、正常範囲との比較結果
- **カレンダー記録**: 記録日、測定実施フラグ、体調メモ、気分メモ、リハビリメモ、測定データへの参照
- **進捗データ**: 期間別統計、回復率、予測データ、正常範囲基準値（手首：掌屈 90°・背屈 70°・尺屈 55°・橈屈 25°、母指：屈曲 90°・伸展 0°・内転 0°・外転 60°）

---

## レビュー・受け入れチェックリスト

_ゲート: main()実行中に自動チェックが実行される_

### コンテンツ品質

- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点
- [x] 非技術系ステークホルダー向けに記述
- [x] すべての必須セクションが完了

### 要件完全性

- [x] [要確認]マーカーが残っていない（すべての基準値が明確化済み）
- [x] 要件がテスト可能で曖昧でない
- [x] 成功基準が測定可能
- [x] スコープが明確に境界付けされている
- [x] 依存関係と前提条件が特定されている

---

## 実行ステータス

_main()処理中に更新される_

- [x] ユーザー説明の解析
- [x] 主要概念の抽出
- [x] 曖昧さのマーク付け
- [x] ユーザーシナリオの定義
- [x] 要件の生成
- [x] エンティティの特定
- [x] レビューチェックリストの合格（すべての確認事項が完了）

---
