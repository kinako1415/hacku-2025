<!-- @format -->

# 機能仕様書: AI 駆動手首・母指可動域リハビリテーションアプリ

**機能ブランチ**: `001-ai-mediapipe-google`
**作成日**: 2025 年 9 月 14 日
**ステータス**: ドラフト
**入力**: ユーザー説明: "手首と母指の可動域を自動で測定・記録するリハビリアプリ。カメラを使った骨格推定 AI（MediaPipe など）で手首（橈骨手根関節）の掌屈・背屈・尺屈・橈屈と、母指（母指手根中手関節）の屈曲・伸展・内転・外転の可動域を測定。毎日の可動域自動記録、Google カレンダー連携でリハビリ・診察予定管理、進捗グラフ表示、AI 励まし機能を含む。"

## 実行フロー (main)

```
1. 入力からユーザー説明を解析 ✓
   → 機能が明確に定義されている: 手首・母指の動作追跡AI駆動リハビリアプリ
2. 説明から主要概念を抽出 ✓
   → アクター: 患者、医療従事者
   → アクション: 動作測定、データ記録、進捗追跡
   → データ: 可動域測定値、カレンダーイベント、進捗データ
   → 制約: 精度要件、日常使用、医療準拠
3. 不明確な点について:
   → 該当箇所に[要確認]でマーク
4. ユーザーシナリオ・テスト項目の記載 ✓
   → リハビリ追跡の明確なユーザーフロー
5. 機能要件の生成 ✓
   → すべての要件がテスト可能で測定可能
6. 主要エンティティの特定 ✓
   → 動作データ、ユーザー、カレンダーイベント、AI評価
7. レビューチェックリストの実行
   → 一部確認が必要だが、コア機能は明確
8. 戻り値: 成功（仕様書は計画段階の準備完了）
```

---

## ⚡ クイックガイドライン

- ✅ ユーザーが何を必要とし、なぜ必要なのかに焦点を当てる
- ❌ 実装方法は避ける（技術スタック、API、コード構造なし）
- 👥 開発者ではなく、ビジネス関係者向けに記述

---

## ユーザーシナリオ・テスト _(必須)_

### 主要ユーザーストーリー

患者は手首や母指のリハビリテーション中に、毎日のトレーニング後にカメラの前で指定された動作を行うことで、自動的に可動域を測定し記録できる。測定データは自動的に保存され、進捗をグラフで確認し、リハビリ予定をカレンダーで管理し、AI からの励ましやアドバイスを受け取ることができる。

### 受け入れシナリオ

1. **前提条件** ユーザーがアプリを開いている状態で、**操作** カメラ測定を開始し手首の掌屈・背屈動作を行う、**期待結果** 可動域の角度が自動測定され記録される
2. **前提条件** 測定データが蓄積されている状態で、**操作** 進捗画面を開く、**期待結果** 時系列グラフで回復の推移が表示される
3. **前提条件** Google カレンダーが連携されている状態で、**操作** リハビリ予定を登録する、**期待結果** カレンダーに自動的にイベントが作成される
4. **前提条件** 毎日測定を継続している状態で、**操作** アプリを開く、**期待結果** AI から進捗に応じた励ましメッセージが表示される
5. **前提条件** 測定が完了した状態で、**操作** データを確認する、**期待結果** 手首（掌屈・背屈・尺屈・橈屈）と母指（屈曲・伸展・内転・外転）の各可動域が記録されている

### エッジケース

- カメラの映像が不鮮明な場合、測定精度が低下した際の警告表示
- ネットワーク接続が不安定な場合のデータ同期処理
- Google カレンダーの認証が切れた場合の再認証フロー
- 測定姿勢が不適切な場合のガイダンス表示
- 可動域に異常な数値が検出された場合のアラート

## 要件 _(必須)_

### 機能要件

- **FR-001**: システムはカメラを使用して手首の掌屈・背屈・尺屈・橈屈の可動域を自動測定できなければならない
- **FR-002**: システムは母指の屈曲・伸展・内転・外転の可動域を自動測定できなければならない
- **FR-003**: システムは測定された可動域データを日付と共に自動記録できなければならない
- **FR-004**: システムは Google カレンダーと連携してリハビリ予定や診察予定を管理できなければならない
- **FR-005**: システムは蓄積された測定データを時系列グラフで表示できなければならない
- **FR-006**: システムは AI による励ましメッセージやアドバイスを提供できなければならない
- **FR-007**: システムは測定精度を保つための姿勢ガイダンスを表示できなければならない
- **FR-008**: システムは可動域の回復予測をグラフで表示できなければならない
- **FR-009**: システムは測定データをクラウドに安全に保存できなければならない
- **FR-010**: システムは過去の測定データと現在の測定値を比較表示できなければならない
- **FR-011**: システムは[要確認: 測定頻度の推奨間隔は？1 日 1 回？複数回？]に基づいて測定リマインダーを送信できなければならない
- **FR-012**: システムは[要確認: 医療従事者への共有機能は必要？]データ共有機能を提供できなければならない
- **FR-013**: システムは[要確認: 可動域の正常範囲の基準値は？]に基づいて異常値を検出できなければならない

### 主要エンティティ _(機能にデータが関わる場合に含める)_

- **ユーザー**: 患者の基本情報、リハビリ開始日、現在の症状レベル
- **動作測定**: 測定日時、手首の各方向可動域（掌屈・背屈・尺屈・橈屈角度）、母指の各方向可動域（屈曲・伸展・内転・外転角度）、測定精度スコア
- **カレンダーイベント**: イベントタイプ（リハビリ/診察）、日時、場所、メモ、Google カレンダー同期状態
- **AI 評価**: 評価日、進捗スコア、励ましメッセージ、改善アドバイス、次回目標値
- **進捗データ**: 期間別統計、回復率、予測データ、比較基準値

---

## レビュー・受け入れチェックリスト

_ゲート: main()実行中に自動チェックが実行される_

### コンテンツ品質

- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点
- [x] 非技術系ステークホルダー向けに記述
- [x] すべての必須セクションが完了

### 要件完全性

- [ ] [要確認]マーカーが残っていない（3 項目の確認が必要）
- [x] 要件がテスト可能で曖昧でない
- [x] 成功基準が測定可能
- [x] スコープが明確に境界付けされている
- [x] 依存関係と前提条件が特定されている

---

## 実行ステータス

_main()処理中に更新される_

- [x] ユーザー説明の解析
- [x] 主要概念の抽出
- [x] 曖昧さのマーク付け
- [x] ユーザーシナリオの定義
- [x] 要件の生成
- [x] エンティティの特定
- [ ] レビューチェックリストの合格（確認事項待ち）

---
